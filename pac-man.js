/* https://p5js.jp/get-started/ */

/* ブロックの大きさ */
let h = 10, w = 10;

/* pac-manの初期位置 */
let pX = 15;
let pY = 15;

class Game {
    constructor() {

        this.stage = [
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
        ];
    }

    // ステージを描画する関数
    draw() {

        /* 枠線の色と太さ */
        stroke(0, 0, 0);
        strokeWeight(1);

        /* ステージの描画 */
        for(let i=0; i<this.stage.length; i++) {
            for(let j=0; j<this.stage[0].length; j++) {
                if(this.stage[i][j] === 1) {  // 配列の中身が1の時
                    fill(51, 51, 153);
                }
                else if(this.stage[i][j] === 0){
                    fill(0, 0, 0);
                }
                else if(this.stage[i][j] === 2){
                    fill(255, 255, 0);
                }
                else if(this.stage[i][j] === 3){
                    fill(255, 0, 0);
                }

                rect(h*(j+1), w*(i+1), h, w)    // ブロックの描画
            }
        }
    }

    // get stage() {
    //     return this.stage;
    // }

    // set stage(stage) {
    //     this.stage = stage;
    // }

    // パックマンを移動させる関数
    movePac_man(command) {
        for(let i=0; i<this.stage.length; i++) {
            for(let j=0; j<this.stage[0].length; j++) {
                if(this.stage[i][j] === 2){

                    if(command === 'left' && this.stage[i][j-1] === 0) {
                        this.stage[i][j] = 0;  
                        this.stage[i][j-1] = 2;
                    } else if(command === 'right' && this.stage[i][j+1] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i][j+1] = 2;
                    } else if(command === 'up' && this.stage[i-1][j] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i-1][j] = 2;
                    } else if(command === 'down' && this.stage[i+1][j] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i+1][j] = 2;
                    }
                    
                    return;
                }
            }
        } 
    }

    // エネミーを移動させる関数
    moveEnemy() {
        for(let i=0; i<this.stage.length; i++) {
            for(let j=0; j<this.stage[0].length; j++) {
                if(this.stage[i][j] === 3){
                    
                    let r = Math.floor(Math.random() * 4);
                    let command = ['left', 'right', 'up', 'down'];

                    if(command[r] === 'left' && this.stage[i][j-1] === 0) {
                        this.stage[i][j] = 0;  
                        this.stage[i][j-1] = 3;
                    } else if(command[r] === 'right' && this.stage[i][j+1] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i][j+1] = 3;
                    } else if(command[r] === 'up' && this.stage[i-1][j] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i-1][j] = 3;
                    } else if(command[r] === 'down' && this.stage[i+1][j] === 0) {
                        this.stage[i][j] = 0;
                        this.stage[i+1][j] = 3;
                    }
                    
                    return;
                }
            }
        } 
    }
}

// class PacMan {

// }

// class Enemy {
    
// }

let game = new Game();

function setup() {
    createCanvas(960, 960);
    redrawAll();
}

function redrawAll() {
    game.draw();
    game.moveEnemy();
}

window.addEventListener('DOMContentLoaded', function(){
    window.addEventListener('keypress', function(e){
      console.log('Key press:' + e.key);

      if(e.key === 'a') game.movePac_man('left'); 
      else if(e.key === 'd') game.movePac_man('right');
      else if(e.key === 'w') game.movePac_man('up');
      else if(e.key === 's') game.movePac_man('down');
      redrawAll();
    }); 
});